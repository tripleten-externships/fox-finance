// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================================================
// ENUMS
// ============================================================================

enum Role {
  ADMIN
  USER
}

// ============================================================================
// MODELS
// ============================================================================

model User {
  id          String       @id // Firebase UID — this is your canonical user identifier
  email       String       @unique
  name        String?
  photoUrl    String?
  role        Role         @default(USER)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  uploadLinks UploadLink[]
}

// ============================================================================
// TODO: Add your models here
// Students should define: Client, UploadLink, DocumentRequest, Upload models
// ============================================================================
enum Status {
  ACTIVE
  INACTIVE
  PENDING
}

model Client {
  id        String   @id @default(uuid()) // Firebase UID — this is your canonical user identifier
  email     String   @unique
  firstName String?
  lastName  String?
  company   String?
  phone     String   @unique
  status    Status   @default(ACTIVE)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  uploadLinks UploadLink[]

  @@index([status])
}

enum UploadStatus {
  COMPLETE
  INCOMPLETE
}
model UploadLink {
  id        String   @id @default(uuid())
  clientId  String
  client    Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  token     String   @unique
  expiresAt DateTime
   status    UploadStatus @default(INCOMPLETE)  
   // added this later so I had to run npx...
  isActive    Boolean      @default(true)   // npx prisma migrate dev --name add-isactive-to-uploadlink

  createdById      String
  user             User              @relation(fields: [createdById], references: [id], onDelete: Cascade)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  documentRequests DocumentRequest[]
  uploads          Upload[]

  @@index([createdById]) // index on the foreign key to User
}



model DocumentRequest {
  id                 String  @id     @default(uuid())
  uploadLinkId       String
  uploadLink         UploadLink   @relation(fields: [uploadLinkId], references: [id], onDelete: Cascade)
  requestedDocuments String[]
  instructions       String?
  status             UploadStatus @default(INCOMPLETE)
  uploads            Upload[]

  @@index([uploadLinkId])
}

model Upload {
  id                String          @id @default(uuid())
  uploadLinkId      String
  uploadLink        UploadLink      @relation(fields: [uploadLinkId], references: [id])
  documentRequestId String
  documentRequest   DocumentRequest @relation(fields: [documentRequestId], references: [id], onDelete: Cascade)
  fileName          String
  fileSize          Int
  s3Key             String
  s3Bucket          String
  uploadedAt        DateTime        @default(now())
  metadata          Json

  @@index([documentRequestId])
  @@index([uploadLinkId])
}



